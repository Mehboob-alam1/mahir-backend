{
  "info": {
    "name": "FindMahir Demoapp API",
    "description": "Auth (email/password, roles USER/MAHIR), forgot/reset password, categories, User CRUD.\n\n**baseUrl:** Default is Railway production. For local: set baseUrl to `http://localhost:8080`.\n\n**Setup:**\n1. Call **Auth > Sign Up (Find Mahir)** or **Sign Up (Become Mahir)** or **Sign In**\n2. Tokens are saved to collection variables automatically\n3. Protected requests use `Authorization: Bearer {{accessToken}}`",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "https://mahir-backend-production.up.railway.app" },
    { "key": "accessToken", "value": "" },
    { "key": "refreshToken", "value": "" },
    { "key": "userId", "value": "" },
    { "key": "resetToken", "value": "" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Sign Up (Find Mahir - USER)",
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 201) {",
                "  var json = pm.response.json();",
                "  if (json.accessToken) pm.collectionVariables.set('accessToken', json.accessToken);",
                "  if (json.refreshToken) pm.collectionVariables.set('refreshToken', json.refreshToken);",
                "  if (json.user && json.user.id) pm.collectionVariables.set('userId', json.user.id);",
                "}"
              ],
              "type": "text/javascript"
            }
          }],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"USER\",\n  \"fullName\": \"Ali Khan\",\n  \"email\": \"ali@example.com\",\n  \"password\": \"secret123\",\n  \"phoneNumber\": \"+923001234567\",\n  \"dateOfBirth\": \"1995-01-20\",\n  \"location\": {\n    \"streetAddress\": \"Block 5, Clifton, Karachi\",\n    \"latitude\": 24.8,\n    \"longitude\": 67.05\n  },\n  \"accountType\": \"FREEMIUM\"\n}"
            },
            "url": "{{baseUrl}}/auth/signup",
            "description": "Register as Find Mahir (customer). Role USER. Saves tokens to collection variables."
          }
        },
        {
          "name": "Sign Up (Become Mahir - MAHIR)",
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 201) {",
                "  var json = pm.response.json();",
                "  if (json.accessToken) pm.collectionVariables.set('accessToken', json.accessToken);",
                "  if (json.refreshToken) pm.collectionVariables.set('refreshToken', json.refreshToken);",
                "  if (json.user && json.user.id) pm.collectionVariables.set('userId', json.user.id);",
                "}"
              ],
              "type": "text/javascript"
            }
          }],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"MAHIR\",\n  \"fullName\": \"Sara Ahmed\",\n  \"email\": \"sara@example.com\",\n  \"password\": \"secret123\",\n  \"phoneNumber\": \"+923009876543\",\n  \"dateOfBirth\": \"1988-11-10\",\n  \"location\": {\n    \"streetAddress\": \"Gulberg III, Lahore\",\n    \"latitude\": 31.52,\n    \"longitude\": 74.36\n  },\n  \"accountType\": \"PREMIUM\",\n  \"serviceCategoryIds\": [1, 2],\n  \"customServiceName\": \"Custom Home Repairs\"\n}"
            },
            "url": "{{baseUrl}}/auth/signup",
            "description": "Register as Become Mahir (professional). Role MAHIR. Use category IDs from GET /api/categories or set customServiceName."
          }
        },
        {
          "name": "Sign In",
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 200) {",
                "  var json = pm.response.json();",
                "  if (json.accessToken) pm.collectionVariables.set('accessToken', json.accessToken);",
                "  if (json.refreshToken) pm.collectionVariables.set('refreshToken', json.refreshToken);",
                "  if (json.user && json.user.id) pm.collectionVariables.set('userId', json.user.id);",
                "}"
              ],
              "type": "text/javascript"
            }
          }],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"ali@example.com\",\n  \"password\": \"secret123\"\n}"
            },
            "url": "{{baseUrl}}/auth/signin",
            "description": "Login (same for USER and MAHIR). Saves tokens to collection variables."
          }
        },
        {
          "name": "Forgot Password",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"ali@example.com\"\n}"
            },
            "url": "{{baseUrl}}/auth/forgot-password",
            "description": "Request password reset. If email exists, a reset link is sent (or logged if SMTP not configured)."
          }
        },
        {
          "name": "Reset Password",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{resetToken}}\",\n  \"newPassword\": \"newSecret456\"\n}"
            },
            "url": "{{baseUrl}}/auth/reset-password",
            "description": "Set new password using token from forgot-password email/link. Set resetToken variable from the link."
          }
        },
        {
          "name": "Refresh Token",
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 200) {",
                "  var json = pm.response.json();",
                "  if (json.accessToken) pm.collectionVariables.set('accessToken', json.accessToken);",
                "  if (json.refreshToken) pm.collectionVariables.set('refreshToken', json.refreshToken);",
                "}"
              ],
              "type": "text/javascript"
            }
          }],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": "{{baseUrl}}/auth/refresh",
            "description": "Get new access and refresh tokens."
          }
        },
        {
          "name": "Check Session",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "GET",
            "url": "{{baseUrl}}/auth/check-session",
            "description": "Validate token and return current user."
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/auth/logout",
            "description": "Logout. Client discards tokens."
          }
        }
      ]
    },
    {
      "name": "Categories",
      "item": [
        {
          "name": "Get All Categories",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/categories",
            "description": "List service categories for MAHIR signup (e.g. Plumbing, Electrical). No auth required."
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Create User",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"New User\",\n  \"email\": \"newuser@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": "{{baseUrl}}/api/users",
            "description": "Create user (legacy; for full signup use Auth > Sign Up). Requires Bearer token."
          }
        },
        {
          "name": "Get All Users",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "GET",
            "url": "{{baseUrl}}/api/users",
            "description": "List all users. Requires Bearer token."
          }
        },
        {
          "name": "Get User by ID",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "GET",
            "url": "{{baseUrl}}/api/users/{{userId}}",
            "description": "Get user by ID. Uses collection variable userId."
          }
        },
        {
          "name": "Update User",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Name\",\n  \"email\": \"updated@example.com\"\n}"
            },
            "url": "{{baseUrl}}/api/users/{{userId}}",
            "description": "Update user. Password optional."
          }
        },
        {
          "name": "Delete User",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{accessToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": "{{baseUrl}}/api/users/{{userId}}",
            "description": "Delete user by ID."
          }
        }
      ]
    }
  ]
}
